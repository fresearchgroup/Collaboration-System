{% extends 'base.html' %}
{%load static %}
{% load mptt_tags %}
{% block css %}
  <link href="{% static 'jquery-pagination/pagination.css' %}" rel="stylesheet" type="text/css">
{% endblock %}

{% block breadcrumb %}
  <li class="breadcrumb-item active"><a href="{% url 'home' %}">Home</a></li>
  <li class="breadcrumb-item"><a href="{% url 'display_communities' %}">Communities</a></li>
  {% for cat in community.get_ancestors %}
    <li class="breadcrumb-item"><a href="{% url 'community_view' cat.pk %}">{{cat.name}}</a> </li>
  {% endfor %}
  <li class="breadcrumb-item active"><a href="{% url 'community_view' community.pk %}">{{ community.name }}</a></li>


{% endblock %}

{% block content %}

  {% if membership.role.name == 'community_admin' %}
<ul class="nav nav-tabs">
  <li class="nav-item active">
    <a class="nav-link " href="#">View</a>
  </li>
  
  <li class="nav-item">
    <a class="nav-link " href="{% url 'manage_community' community.pk %}">Manage Community</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{% url 'update_community_info' community.pk %}">Update community Info</a>
  </li>
  {% if membership.role.name == 'author' or membership.role.name == 'publisher' or membership.role.name == 'community_admin' %}
  <li class="nav-item">
    <a class="nav-link" href="{% url 'community_content' community.pk %}">Contributions</a>
  </li>
   <li class="nav-item">
    <a class="nav-link" href="{% url 'community_feed' community.pk %}">Feeds</a>
  </li>
  {%endif%}
  <!-- {% if community.parent == None %}
  <li class="nav-item">
	  <a class="nav-link" href="/forum/forum/{{ community.forum_link }}">Forum</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{% url 'community_dashboard' community.pk %}">Insights</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/wiki/{{community.name}}{{ community.pk }}">Wiki</a>
  </li>
  {% endif %} -->
</ul>
{%endif%}

{% if messages %}
    {% for message in messages %}
      {% if message.tags %}<div class="alert alert-{{ message.tags }}" role="alert">{% endif %}{{ message }}</div>
    {% endfor %}

{% endif %}
<br/>

<div class="main">
  <div class="container">

    <div class="row margin-bottom-10">
      <!-- BEGIN CONTENT -->
      <div class="col-md-12 col-sm-12">
        <div class="icp-content-comm-title-image">
          <h2 class="icp-content-comm-title-text">
            {{ community.name}}
          </h2>
        </div>
          <!-- {% if community.image %}
          <img src="{{ MEDIA_URL }}{{ community.image}}" alt="image" class="img-responsive" style="width: 100%; height:350px;">
          {% else %}
          <img src="{{ MEDIA_URL }}default/community_image_default.png" alt="default" class="img-responsive" style="width: 100%; height:350px;">
          {%endif%} -->
      </div>
    </div>

  



    {% if community.level == 0 %}
    <table id="listPow" class="table table-striped table-bordered" cellspacing="0" width="100%">
      <thead>
          <tr style="background-color:#89216B">
            <th style="color:white">Name</th>
            <th style="color:white">Address</th>
            <th style="color:white">Accepting Contributions</th>
            <th style="color:white">Draft</th>
            <th style="color:white">Submitted</th>
            <th style="color:white">In-review</th>
            <th style="color:white">Modify</th>
            <th style="color:white">Accepted</th>
            <th style="color:white">Rejected</th>
            <th style="color:white">Action</th>
          </tr>
      </thead>
      <tbody>
        {{myhtml|safe}}{% autoescape off%}
        {% for child in children %}
          <tr>
            <td>
              <a href="{% url 'community_view' child.pk %}">{{child.name}}</a>
            </td>
            <td>
              {{child.area}}, {{child.city}}, {{child.state}}, {{child.pincode}}
            </td>
            <td>
              {% if child.contribution_status == 'Ongoing' %} 
                Yes
              {% else %}
                No
              {% endif %}
            </td>
            <td>{{child.draftCount}}</td>
            <td>{{child.submittedCount}}</td>
            <td>{{child.inreviewCount}}</td>
            <td>{{child.modifyCount}}</td>
            <td>{{child.acceptedCount}}</td>
            <td>{{child.rejectedCount}}</td>
            <td>
              {% if child.contribution_status == 'Ongoing' %}
                {% if user.is_authenticated %}
                <a href="{% url 'community_view' child.pk %}">Contribute</a>
                  <!-- <a href="{% url 'community_article_create' child.pk %}"><button type="button" class="btn btn-success"><p><i class="fa fa-file-text-o" style="font-size:24px;"></i></p></button></a>
                  <a href="{% url 'community_media_create' child.pk 'IMAGE'%}"><button type="button" class="btn btn-success"><p><i class="fa fa-picture-o" style="font-size:24px;"></i></p></button></a>
                  <a href="{% url 'community_media_create' child.pk 'AUDIO' %}"><button type="button" class="btn btn-success"><p><i class="fa fa-music" style="font-size:24px;"></i></p></button></a>
                  <a href="{% url 'community_media_create' child.pk 'VIDEO' %}"><button type="button" class="btn btn-success"><p><i class="fa fa-film" style="font-size:24px;"></i></p></button></a> -->
                {% endif %}
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        {% endautoescape%}
      </tbody>
    </table>

    {% if user.is_authenticated and not request.user.is_superuser %}
      <h4>
        Can't find a {{ community.name }}? 
        <form method = "get" action ="{% url 'request_community_creation' %}">
          <input type="hidden" name="cid" value={{community.pk}}>
          <button type="radio" name ="status" value="submit" class="btn btn-success" >Click to add</button>
        </form>
      </h4>
    {% endif %}
  {% endif %}

  {% if community.level == 1 %}
  <table id="listPow" class="table table-striped table-bordered" cellspacing="0" width="100%">
    <thead>
        <tr style="background-color:#89216B">
          <th style="color:white">Name</th>
          <th style="color:white">Contribute</th>
        </tr>
    </thead>
    <tbody>
      {{myhtml|safe}}{% autoescape off%}
      {% for child in children %}
        <tr>
          <td>
            <a href="{% url 'community_view' child.pk %}">{{child.name}}</a>
          </td>
          <td>
            {% if user.is_authenticated %}
              <a href="{% url 'community_article_create' child.pk %}"><button type="button" class="btn btn-success"><p><i class="fa fa-file-text-o" style="font-size:24px;"></i></p></button></a>
              <a href="{% url 'community_media_create' child.pk 'IMAGE'%}"><button type="button" class="btn btn-success"><p><i class="fa fa-picture-o" style="font-size:24px;"></i></p></button></a>
              <a href="{% url 'community_media_create' child.pk 'AUDIO' %}"><button type="button" class="btn btn-success"><p><i class="fa fa-music" style="font-size:24px;"></i></p></button></a>
              <a href="{% url 'community_media_create' child.pk 'VIDEO' %}"><button type="button" class="btn btn-success"><p><i class="fa fa-film" style="font-size:24px;"></i></p></button></a>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
      {% endautoescape%}
    </tbody>
  </table>
  {% endif %}


  </div>
</div>

{% if membership.role.name == 'community_admin' %}
<form method = "get" action ="{% url 'community_group' community.pk%}">
  <button type="radio" name ="status" value="submit" class="btn btn-success" >Create sub-community</button>
</form>
{% endif %}

{% endblock %}